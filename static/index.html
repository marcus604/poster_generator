<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plex Poster Generator</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar: Video Browser & Controls -->
        <aside class="sidebar" id="sidebar">
            <h1 class="app-title">Poster Generator</h1>

            <!-- Step 1: Video Selection -->
            <section class="panel" id="video-panel">
                <h2 class="panel-title">1. Select Video</h2>
                <div class="file-browser" id="file-browser">
                    <div class="browser-nav">
                        <button class="btn btn-small" id="btn-back" disabled>&larr; Back</button>
                        <span class="current-path" id="current-path">/</span>
                    </div>
                    <ul class="file-list" id="file-list">
                        <li class="loading">Loading videos...</li>
                    </ul>
                </div>
                <div class="video-info" id="video-info" style="display: none;">
                    <p><strong>Selected:</strong> <span id="selected-video-name"></span></p>
                    <p><span id="video-resolution"></span> &bull; <span id="video-duration"></span></p>
                </div>
            </section>

            <!-- Step 2: Background Options -->
            <section class="panel" id="background-panel" style="display: none;">
                <h2 class="panel-title">2. Background</h2>
                <div class="toggle-group">
                    <button class="toggle-btn active" data-mode="image">Image</button>
                    <button class="toggle-btn" data-mode="color">Color</button>
                    <button class="toggle-btn" data-mode="gradient">Gradient</button>
                </div>

                <!-- Image Mode Controls -->
                <div class="mode-controls" id="image-controls">
                    <label>Frame Selection</label>
                    <div class="slider-container">
                        <button class="btn btn-small frame-nav-btn" id="btn-prev-frame" title="Previous frame (←)">&larr;</button>
                        <input type="range" id="frame-slider" min="0" max="100" value="0" step="0.1">
                        <button class="btn btn-small frame-nav-btn" id="btn-next-frame" title="Next frame (→)">&rarr;</button>
                        <span id="timestamp-display">0:00</span>
                    </div>
                    <div class="thumbnail-strip" id="thumbnail-strip"></div>
                    <div class="selection-controls">
                        <label>Selection Size</label>
                        <div class="slider-row">
                            <input type="range" id="zoom-slider" min="50" max="150" value="100">
                            <button class="btn btn-small" id="btn-reset-overlay" title="Center selection">Reset</button>
                        </div>
                    </div>
                    <label>Blur: <span id="blur-value">0</span></label>
                    <input type="range" id="image-blur" min="0" max="20" value="0" step="1">
                </div>

                <!-- Color Mode Controls -->
                <div class="mode-controls" id="color-controls" style="display: none;">
                    <label>Background Color</label>
                    <input type="color" id="bg-color" value="#000000">
                </div>

                <!-- Gradient Mode Controls -->
                <div class="mode-controls" id="gradient-controls" style="display: none;">
                    <label>Color 1</label>
                    <input type="color" id="gradient-color-1" value="#000000">
                    <label>Color 2</label>
                    <input type="color" id="gradient-color-2" value="#333333">
                    <label>Direction</label>
                    <select id="gradient-direction">
                        <option value="vertical">Vertical</option>
                        <option value="horizontal">Horizontal</option>
                        <option value="diagonal">Diagonal</option>
                    </select>
                </div>

                <!-- Confirm Background Button -->
                <button class="btn btn-primary" id="btn-confirm-background" style="margin-top: 15px; width: 100%;">
                    Confirm Background &rarr;
                </button>
            </section>

            <!-- Step 3: Text & Elements -->
            <section class="panel" id="text-panel" style="display: none;">
                <h2 class="panel-title">3. Text & Elements</h2>
                <div class="button-row">
                    <button class="btn" id="btn-change-background">&larr; Change Background</button>
                    <button class="btn" id="btn-add-text">+ Add Text</button>
                    <button class="btn" id="btn-add-line">+ Add Line</button>
                </div>

                <div class="text-editor" id="text-editor" style="display: none;">
                    <h3>Text Properties</h3>
                    <textarea id="text-content" placeholder="Enter text (multiple lines supported)..." rows="3"></textarea>
                    <div class="form-row">
                        <select id="font-family">
                            <option value="Arial">Arial</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Verdana">Verdana</option>
                            <option value="Impact">Impact</option>
                        </select>
                        <input type="number" id="font-size" value="32" min="8" max="200">
                    </div>
                    <div class="form-row">
                        <input type="color" id="text-color" value="#ffffff">
                        <button class="btn btn-small format-btn" id="btn-bold" title="Bold">B</button>
                        <button class="btn btn-small format-btn" id="btn-italic" title="Italic"><em>I</em></button>
                        <button class="btn btn-small format-btn" id="btn-underline" title="Underline"><u>U</u></button>
                    </div>
                    <div class="form-row">
                        <span class="form-label">Align:</span>
                        <button class="btn btn-small format-btn" id="btn-align-left" title="Align Left">&#9664;</button>
                        <button class="btn btn-small format-btn active" id="btn-align-center" title="Align Center">&#9632;</button>
                        <button class="btn btn-small format-btn" id="btn-align-right" title="Align Right">&#9654;</button>
                    </div>
                    <button class="btn btn-danger btn-small" id="btn-delete-text">Delete</button>
                </div>

                <div class="line-editor" id="line-editor" style="display: none;">
                    <h3>Line Properties</h3>
                    <div class="form-row">
                        <input type="color" id="line-color" value="#ffffff">
                        <input type="number" id="line-width" value="2" min="1" max="20" title="Line width">
                    </div>
                    <button class="btn btn-danger btn-small" id="btn-delete-line">Delete</button>
                </div>
            </section>

            <!-- Step 4: Generate -->
            <section class="panel" id="generate-panel" style="display: none;">
                <h2 class="panel-title">4. Generate</h2>
                <div class="form-row">
                    <input type="text" id="output-filename" placeholder="poster_name">
                    <span class="extension">.png</span>
                </div>
                <button class="btn btn-primary btn-large" id="btn-generate">Generate Poster</button>
                <div id="generation-status"></div>
            </section>
        </aside>

        <!-- Main Canvas Area -->
        <main class="canvas-area">
            <div class="canvas-wrapper" id="canvas-wrapper">
                <canvas id="poster-canvas"></canvas>
            </div>
            <div class="canvas-info">
                <span>Drag the selection box to choose poster area • Output: 1000 × 1500px (2:3)</span>
            </div>
        </main>
    </div>

    <script src="/static/js/api-client.js?v=8"></script>
    <script src="/static/js/canvas-manager.js?v=8"></script>
    <script src="/static/js/text-editor.js?v=8"></script>
    <script src="/static/js/frame-slider.js?v=8"></script>
    <script src="/static/js/app.js?v=8"></script>
</body>
</html>
